# How To Build

## Summary

Supported platforms:

- MacOS
- Most Linux-based OSes
- BSD's

Steps:

- install `dcc` (`go get github.com/atrn/dcc`, see below)
- build ici using `make` (`gmake` on BSDs)
- install using `make install dest=/some/path`

## Overview

There are several ways to build ici. The _official_ way, shown above,
is the method I use. GNU make is used to direct things and another
tool, `dcc`, looks after compilation, linking and library creation.

### Building with make and dcc

The _make and dcc_ method supports building ICI in a number of
different configurations - standalone executable, static library and
executable, or dynamic library and executable - and adds make targets
to install ici and other tasks.

This method is described below.

### Building with cmake

A very simple `CMakeLists.txt` is supplied which builds a standalone
interpreter executable. `cmake` support is minimal but can be used to
generate files for IDEs and other build tools (ninja works well).

Run `cmake` to generate build files, e.g.,

    $ cmake -Bbuild -H.

This will create a `build` directory with the `cmake` generated
build files. `ccmake` can be used to adjust build settings. For
more details see the cmake documentation.

### Makefiles

Some conventional makefiles are located in the `etc` directory. These
can be used as is or act as a starting point for creating better
makefiles tailored to your environment.

### Building by hand

A standalone executable build is essentially trivial on current
UNIX-ish systems. The following command is sufficient on supported
platforms.

    $ c++ -std=c++14 -I. -UNDEBUG *.cc etc/main.cc -o ici



## Building ICI with make and dcc

The supported build system for ICI uses GNU `make` and my compiler
driver program, `dcc`. You likely already have GNU `make` or know
where to get it. Installing `dcc` is straight forward.

### Install `dcc`

`dcc` is open source (licensed under the GNU GPL v2) and available
from [http://github.com/atrn/dcc](http://github.com/atrn/dcc). `dcc`
is written in Go and installation requires Go be installed (some
platforms do this via their package manager otherwise Go can be
obtained via [golang.org](http://golang.org/)). Installation is
straight forward. Follow their instructions.

Assuming a conventional Go installation (i.e. you followed the
instructions), installing `dcc` is done with the command,

    $ go get github.com/atrn/dcc

By default `go get` will install the binary under your _$GOPATH_ or
`~/go/bin` by default. If you've set _$GOPATH_ I assume you know
what you're doing and where the `dcc` executable resides.

### Build

With `dcc` installed building ICI is done via `make`,

    $ make

`make` _directs_ the build process and invokes `dcc` for compilation,
linking and library creation.

To configure the build process the `Makefile` can be edited to set
installation locations and other variables. The makefile is quite
simple (since `dcc` does the real work) and commented.

### Targets and macros

Typically development workflows are supported by make targets
and macros. Some common operations are shown below:

Build a standalone executable,

    $ make build=exe

Build a static library, `libici.a`, with the `ici` executable linked
against that library.

    $ make build=lib

Build a dynamic library, e.g. `libici.so`, and an `ici` executable
linked against that library.

    $ make build=dll

Clean up files generated by the build.

    $ make clean

Build using debug options.

    $ make debug


## Platform configuration

More control over the configuration is available by setting the
`CONFIG_FILE` macro to the, quoted, name of a header file that defines
the interpreter's configuration.

The file named by `CONFIG_FILE` is included by the `fwd.h` header file
(which is included by all ici source files). If `CONFIG_FILE` is not
set `fwd.h` selects a file for the host if it can determine it.

The standard _conf_ header files are located in the `conf` directory.

## Installation

Installing requires copying the executable somewhere and copying the
_core_ `.ici` files to a _lib_ directory.

- `ici` -> _$(dest)/bin/ici_
- `ici-core*.ici` -> _$(dest)/lib/ici_

If an ici library was built, static or dynamic, that is copied to a
_lib_ directory and the `ici.h` header file to the `include` directory
along with another header, `icistr-setup.h`.
