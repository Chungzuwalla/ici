local print_env(caption, key, op, val) {
    pval := string(val);
    if (val == NULL)
        pval = "null";
    printf("\n%s\n%s %s %s\n", caption, key, op, pval);
}

print_env("Current environment", "FOO", "==", env.FOO);

env.FOO = "Bar";

print_env("Post-assignment environment", "FOO", "==", env.FOO);

# printf("\nAfter assigning env.FOO = \"Bar\"\nFOO == %s\n", string(env.FOO));

printf("\n$FOO in a sub-shell?\n");
flush();

system("echo FOO=$FOO");

file := popen("echo $FOO");
value := getline(file);
try close(file); onerror ; 


if (value == "")
    printf("FOO is not set in popen\n");
else
    printf("FOO is \"%s\" in a popen'd shell\n", string(value));
